var crypto = require('crypto');
var _ = require('lodash');

var Oauth = {

    buildSignature: function(params, url, method, consumerSecret, tokenSecret){
        var method = method.toUpperCase();
        var url = encodeURIComponent(url);
        consumerSecret = encodeURIComponent(consumerSecret);
        tokenSecret = tokenSecret ? encodeURIComponent(tokenSecret) : '';

        var parameterString = '';

        _.each(params, function(item){
            parameterString += '&' + item.key + '=' + item.value;
        })

        parameterString = parameterString.substring(1);

        var baseString = method + '&' + url + '&' + encodeURIComponent(parameterString);
        var signingKey = consumerSecret + '&' + tokenSecret;


        var signature = crypto.createHmac('sha1', signingKey).update(baseString).digest('base64');

        return signature;
    },

    generateNonce: function(){
        var text = "";
        var possible = "abcdefghijklmnopqrstuvwxyz0123456789";

        for( var i=0; i < 32; i++ )
            text += possible.charAt(Math.floor(Math.random() * possible.length));

        return text;
    },

};

module.exports = Oauth;